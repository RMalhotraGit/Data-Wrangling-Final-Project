---
title: "Final Project"
author: "Rahul Malhotra"
date: "4/22/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r}
rm(list = ls())
```

```{r message = FALSE}
library(knitr)
library(tidyr)
library(dplyr)
```

```{r message = FALSE, warning = FALSE}
source("Cleaning Scripts/world.R")
source("Cleaning Scripts/us.R")
source("Cleaning Scripts/nj.R")
source("Cleaning Scripts/bergen.R")
source("functions.R")
```

```{r}
# Saving tidy version of datasets as csv files

#write.csv(world, "Datasets/world.csv", row.names = TRUE)
#write.csv(us, "Datasets/us.csv", row.names = TRUE)
#write.csv(nj, "Datasets/nj.csv", row.names = TRUE)
#write.csv(bergen, "Datasets/bergen.csv", row.names = TRUE)
```

# Let's first take a small look into our datasets:

## World Data
```{r}
kable(select(world, `Country,Other`, TotalCases, TotalDeaths)[1:5,])
```

## United States Data
```{r}
kable(select(us, USAState, TotalCases, TotalDeaths)[1:5,])
```

## New Jersey Data
```{r}
kable(select(nj, County, TotalCases, TotalDeaths)[1:5,])
```

## Bergen County, NJ Data
```{r}
kable(select(bergen, `City/Town`, TotalCases)[1:5,])
```

# First, let's focus on the World data set
## Let's see which countries are recovering the best
```{r}
recovered <- world %>%
  filter(TotalCases > 500) %>%  # adding a filter on our data
  group_by(`Country,Other`, TotalCases) %>%
  summarize(RecoveryRate = TotalRecovered/TotalCases) %>% # use recovery rate for a better measure
  arrange(desc(RecoveryRate)) %>%
  head(10)

kable(select(recovered, `Country,Other`, RecoveryRate, TotalCases))
```

We see China is among the countries with the best recovery rate, which we may expect due to their rapid response and strict restrictions. However, we see Iceland with the greatest recovery rate which is surprising since not many people talk about its success at containing the virus.
Note: Only countries with more than 500 total cases were considered.

## Now let's look at which are doing the worst
```{r}
deathRate <- world %>%
  filter(TotalCases > 500) %>% # adding a filter to on our data
  group_by(`Country,Other`, TotalCases) %>%
  summarize(DeathRate = TotalDeaths/TotalCases) %>%
  arrange(desc(DeathRate)) %>%
  head(10)

kable(select(deathRate, `Country,Other`, DeathRate, TotalCases))
```

Among the top countries with the highest death rates, we see many european countries, including Italy and France. We expect to see them as they have been getting a lot of attention in the news due to the severity of the virus in their respective countries. However, interestingly, we do not need see the United States among the countries with the highest death rates, despite having both the most deaths and cases.

## Predicting Number of Deaths
```{r}
lm.mod <- lm.deaths(world)
coefficients(lm.mod)
```

Using a naive approach, we construct a univariate linear model where the response is the total number of deaths and the predictor is the total number of cases. Looking at the coefficient for the total cases, we see it is about 0.064. That is, for every new case, we expect the number of deaths to increase by 0.064. In other words, we can say that the death rate is around 6%. However, let's get the death rate for each country, and compare its average to this value.

```{r}
AverageDeathRate <- mean(deathRate$DeathRate)
print <- paste(c("The average death rate among all countries is", AverageDeathRate), sep = " ")
cat(print)
```

Taking the average of the death rate among all countries, we see that is about 0.126, which is about double the coefficient we got in our linear model. We should expect a disparity in the two values since the linear model only considers the number of cases as a predictor. There are likely several other characteristics within a country that play a role in determining the number of deaths a country will have, namely those having to do with that country's health care and ability to treat those who have been affected.